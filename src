var  apiKey  =  '3f301be7381a03ad8d352314dcc3ec1d' ;
deixe  apiKey ;
deixe  requestToken ;
deixe nome de  usuário ;
deixe  senha ;
deixe  sessionId ;
let  listId  =  '7101979' ;

deixe  loginButton  =  document . getElementById ( 'botão de login' ) ;
deixe  searchButton  =  document . getElementById ( 'botão de busca' ) ;
deixe  searchContainer  =  document . getElementById ( 'search-container' ) ;

botão de login . addEventListener ( 'click' ,  assíncrono  ( )  =>  {
  await  criarRequestToken ( ) ;
  aguarde  logar ( ) ;
  aguarde  criarSessao ( ) ;
} )

botão de pesquisa . addEventListener ( 'click' ,  assíncrono  ( )  =>  {
  deixe  lista  =  documento . getElementById ( "lista" ) ;
  if  ( lista )  {
    lista . externalHTML  =  "" ;
  }
  deixe  query  =  document . getElementById ( 'pesquisa' ) . valor ;
  deixe  listaDeFilmes  =  esperar  procurarFilme ( consulta ) ;
  deixe  ul  =  documento . createElement ( 'ul' ) ;
  ul . id  =  "lista"
  for  ( const  item  da  listaDeFilmes . resultados )  {
    deixe  li  =  documento . createElement ( 'li' ) ;
    li . appendChild ( document . createTextNode ( item . original_title ) )
    ul . appendChild ( li )
  }
  consola . log ( listaDeFilmes ) ;
  searchContainer . appendChild ( ul ) ;
} )

function  preencherSenha ( )  {
  senha  =  documento . getElementById ( 'senha' ) . valor ;
  validLoginButton ( ) ;
}

função  preencherLogin ( )  {
  nome de usuário  =   documento . getElementById ( 'login' ) . valor ;
  validLoginButton ( ) ;
}

function  preencherApi ( )  {
  apiKey  =  documento . getElementById ( 'api-key' ) . valor ;
  validLoginButton ( ) ;
}

function  validLoginButton ( )  {
  if  ( senha  && nome de  usuário  &&  apiKey )  {
    botão de login . desabilitado  =  falso ;
  }  senão  {
    botão de login . desabilitado  =  verdadeiro ;
  }
}

class  HttpClient  {
  static  assíncrono  get ( { url , method , body =  null } )  {
    return  new  Promise ( ( resolve ,  rejeita )  =>  {
      deixe  pedido  =  new  XMLHttpRequest ( ) ;
      pedido . open ( método ,  url ,  true ) ;

      pedido . carregar  =  ( )  =>  {
        if  ( request . status  >=  200  &&  request . status  <  300 )  {
          resolver ( JSON.parse ( solicitação.respostaTexto ) ) ; _ _ _ _
        }  senão  {
          rejeitar ( {
            estado : pedido . estado ,
            statusText : pedido . statusText
          } )
        }
      }
      pedido . onerro  =  ( )  =>  {
        rejeitar ( {
          estado : pedido . estado ,
          statusText : pedido . statusText
        } )
      }

      if  ( corpo )  {
        pedido . setRequestHeader ( "Content-Type" ,  "application/json;charset=UTF-8" ) ;
        corpo  =  JSON . stringify ( corpo ) ;
      }
      pedido . enviar ( corpo ) ;
    } )
  }
}

 função  assíncrona procurarFilme ( consulta )  {
  consulta  =  encodeURI ( consulta )
  consola . log ( consulta )
  deixe  resultado  =  aguardar  HttpClient . obter ( {
    url : `https://api.themoviedb.org/3/search/movie?api_key= ${ apiKey } &query= ${ query } ` ,
    método : "GET"
  } )
  retornar  resultado
}

 função  assíncrona adicionarFilme ( filmeId )  {
  deixe  resultado  =  aguardar  HttpClient . obter ( {
    url : `https://api.themoviedb.org/3/movie/ ${ filmeId } ?api_key= ${ apiKey } &language=en-US` ,
    método : "GET"
  } )
  consola . log ( resultado ) ;
}

 função  assíncrona criarRequestToken  ( )  {
  deixe  resultado  =  aguardar  HttpClient . obter ( {
    url : `https://api.themoviedb.org/3/authentication/token/new?api_key= ${ apiKey } ` ,
    método : "GET"
  } )
  requestToken  =  resultado . request_token
}

 logar de função  assíncrona ( ) { 
  aguarde  HttpClient . obter ( {
    url : `https://api.themoviedb.org/3/authentication/token/validate_with_login?api_key= ${ apiKey } ` ,
    método : "POST" ,
    corpo : {
      nome de usuário : ` ${ nome de usuário } ` ,
      senha : ` ${ senha } ` ,
      request_token : ` ${ requestToken } `
    }
  } )
}

 função  assíncrona criarSessao ( )  {
  deixe  resultado  =  aguardar  HttpClient . obter ( {
    url : `https://api.themoviedb.org/3/authentication/session/new?api_key= ${ apiKey } &request_token= ${ requestToken } ` ,
    método : "GET"
  } )
  sessionId  =  resultado . session_id ;
}

 função  assíncrona criarLista ( nomeDaLista ,  descricao )  {
  deixe  resultado  =  aguardar  HttpClient . obter ( {
    url : `https://api.themoviedb.org/3/list?api_key= ${ apiKey } &session_id= ${ sessionId } ` ,
    método : "POST" ,
    corpo : {
      nome : nomeDaLista ,
      descrição : descrição ,
      idioma : "pt-br"
    }
  } )
  consola . log ( resultado ) ;
}

 função  assíncrona adicionarFilmeNaLista ( filmeId ,  listaId )  {
  deixe  resultado  =  aguardar  HttpClient . obter ( {
    url : `https://api.themoviedb.org/3/list/ ${ listaId } /add_item?api_key= ${ apiKey } &session_id= ${ sessionId } ` ,
    método : "POST" ,
    corpo : {
      media_id : filmeId
    }
  } )
  consola . log ( resultado ) ;
}

 função  assíncrona pegarLista ( )  {
  deixe  resultado  =  aguardar  HttpClient . obter ( {
    url : `https://api.themoviedb.org/3/list/ ${ listId } ?api_key= ${ apiKey } ` ,
    método : "GET"
  } )
  consola . log ( resultado ) ;
